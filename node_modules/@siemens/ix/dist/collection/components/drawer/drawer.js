/*
 * SPDX-FileCopyrightText: 2023 Siemens AG
 *
 * SPDX-License-Identifier: MIT
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
import { iconClose } from "@siemens/ix-icons/icons";
import { h, Host, } from "@stencil/core";
import { animate } from "animejs";
import Animation from "../utils/animation";
/**
 * @deprecated Will be removed with 5.0.0, use ix-pane as successor
 */
export class Drawer {
    constructor() {
        /**
         * Show or hide the drawer
         */
        this.show = false;
        /**
         * Fired in case of an outside click during drawer showed state
         */
        // eslint-disable-next-line @stencil-community/ban-default-true
        this.closeOnClickOutside = true;
        /**
         * Render the drawer with maximum height
         */
        this.fullHeight = false;
        /**
         * Min width interpreted as REM
         */
        this.minWidth = 16;
        /**
         * Max width interpreted as REM
         */
        this.maxWidth = 28;
        /**
         * Width interpreted as REM if not set to 'auto'
         */
        this.width = this.minWidth;
        this.toggle = false;
        this.callback = this.clickedOutside.bind(this);
        this.showContent = true;
    }
    onShowChanged(newValue, oldValue) {
        if (newValue === oldValue) {
            return;
        }
        this.toggleDrawer(newValue);
    }
    /**
     * Toggle or define show state of drawer
     * @param show Overwrite toggle state with boolean
     */
    async toggleDrawer(show) {
        show = show !== null && show !== void 0 ? show : !this.show;
        if (show) {
            const { defaultPrevented } = this.open.emit();
            if (defaultPrevented) {
                return;
            }
            this.show = true;
            if (!this.toggle && this.divElement) {
                this.slideInRight(this.divElement);
                setTimeout(() => {
                    window.addEventListener('mousedown', this.callback);
                }, Animation.mediumTime);
            }
        }
        else {
            const { defaultPrevented } = this.drawerClose.emit();
            if (defaultPrevented) {
                return;
            }
            this.show = false;
            if (this.toggle && this.divElement) {
                this.slideOutRight(this.divElement);
            }
            window.removeEventListener('mousedown', this.callback);
        }
        this.toggle = this.show;
        return Promise.resolve();
    }
    onCloseClicked() {
        this.toggleDrawer(false);
    }
    clickedOutside(evt) {
        if (!this.closeOnClickOutside) {
            return;
        }
        const target = evt.target;
        const closestElement = target.closest('#div-container');
        const btn = target.closest('#drawer-btn');
        if (evt.target.type !== 'button' &&
            closestElement !== this.divElement &&
            target !== btn) {
            this.show = false;
        }
    }
    getConstrainedWidth(width) {
        return Math.min(Math.max(width, this.minWidth), this.maxWidth);
    }
    slideOutRight(el) {
        const initialWidth = `${this.getConstrainedWidth(this.width === 'auto' ? this.minWidth : this.width)}rem`;
        animate(el, {
            duration: Animation.mediumTime,
            width: [initialWidth, 0],
            opacity: [1, 0],
            easing: 'easeInSine',
            onComplete: () => {
                el.classList.add('display-none');
            },
        });
    }
    slideInRight(el) {
        const targetWidth = `${this.getConstrainedWidth(this.width === 'auto' ? this.minWidth : this.width)}rem`;
        animate(el, {
            duration: Animation.mediumTime,
            width: [0, targetWidth],
            opacity: [0, 1],
            easing: 'easeOutSine',
            onBegin: () => {
                el.classList.remove('display-none');
            },
            onComplete: () => {
                this.showContent = true;
            },
        });
    }
    componentDidLoad() {
        this.toggleDrawer(this.show);
    }
    render() {
        return (h(Host, { key: 'f40c42d1e7b7e8420c4a8f804a46b722580dd132', class: {
                'drawer-container': true,
                'display-none': true,
            }, style: {
                width: '0',
                'max-width': `${this.maxWidth}rem`,
                height: this.fullHeight ? '100%' : 'auto',
                overflow: 'hidden',
            }, ref: (el) => (this.divElement = el), "data-testid": "container", id: "div-container" }, h("div", { key: '810a3738ce5350281d758808ba93981914760877', style: {
                width: this.width === 'auto'
                    ? 'auto'
                    : `${this.getConstrainedWidth(this.width)}rem`,
            } }, h("div", { key: '5601266a5a02c122d1392234fe1c1a755e440bad', class: "header" }, h("div", { key: 'a43e56c621a03939233e10bb907e6f2bd7a7e176', class: "header-content" }, h("slot", { key: 'ab7c9e45ca78c512c1a242f53a616a16a98187fe', name: "header" })), h("ix-icon-button", { key: 'eaaa6f03ffdf2f5e2d9100ab3f45c4a1f46ef63d', class: "close-button", style: {
                display: this.showContent ? 'block' : 'none',
            }, icon: iconClose, iconColor: "color-soft-text", size: "24", variant: "tertiary", onClick: () => this.onCloseClicked(), "data-testid": "close-button", "aria-label": this.ariaLabelCloseButton })), h("div", { key: '170d74d584fb7b641adaa45800144a27f4354d92', class: "content", style: {
                display: this.showContent ? 'block' : 'none',
            } }, h("slot", { key: 'de087859ac50be70b998ab696698df91f6816f21' })))));
    }
    static get is() { return "ix-drawer"; }
    static get encapsulation() { return "shadow"; }
    static get originalStyleUrls() {
        return {
            "$": ["drawer.scss"]
        };
    }
    static get styleUrls() {
        return {
            "$": ["drawer.css"]
        };
    }
    static get properties() {
        return {
            "show": {
                "type": "boolean",
                "attribute": "show",
                "mutable": true,
                "complexType": {
                    "original": "boolean",
                    "resolved": "boolean",
                    "references": {}
                },
                "required": false,
                "optional": false,
                "docs": {
                    "tags": [],
                    "text": "Show or hide the drawer"
                },
                "getter": false,
                "setter": false,
                "reflect": false,
                "defaultValue": "false"
            },
            "closeOnClickOutside": {
                "type": "boolean",
                "attribute": "close-on-click-outside",
                "mutable": false,
                "complexType": {
                    "original": "boolean",
                    "resolved": "boolean",
                    "references": {}
                },
                "required": false,
                "optional": false,
                "docs": {
                    "tags": [],
                    "text": "Fired in case of an outside click during drawer showed state"
                },
                "getter": false,
                "setter": false,
                "reflect": false,
                "defaultValue": "true"
            },
            "fullHeight": {
                "type": "boolean",
                "attribute": "full-height",
                "mutable": false,
                "complexType": {
                    "original": "boolean",
                    "resolved": "boolean",
                    "references": {}
                },
                "required": false,
                "optional": false,
                "docs": {
                    "tags": [],
                    "text": "Render the drawer with maximum height"
                },
                "getter": false,
                "setter": false,
                "reflect": false,
                "defaultValue": "false"
            },
            "minWidth": {
                "type": "number",
                "attribute": "min-width",
                "mutable": false,
                "complexType": {
                    "original": "number",
                    "resolved": "number",
                    "references": {}
                },
                "required": false,
                "optional": false,
                "docs": {
                    "tags": [],
                    "text": "Min width interpreted as REM"
                },
                "getter": false,
                "setter": false,
                "reflect": false,
                "defaultValue": "16"
            },
            "maxWidth": {
                "type": "number",
                "attribute": "max-width",
                "mutable": false,
                "complexType": {
                    "original": "number",
                    "resolved": "number",
                    "references": {}
                },
                "required": false,
                "optional": false,
                "docs": {
                    "tags": [],
                    "text": "Max width interpreted as REM"
                },
                "getter": false,
                "setter": false,
                "reflect": false,
                "defaultValue": "28"
            },
            "width": {
                "type": "any",
                "attribute": "width",
                "mutable": false,
                "complexType": {
                    "original": "number | 'auto'",
                    "resolved": "\"auto\" | number",
                    "references": {}
                },
                "required": false,
                "optional": false,
                "docs": {
                    "tags": [],
                    "text": "Width interpreted as REM if not set to 'auto'"
                },
                "getter": false,
                "setter": false,
                "reflect": false,
                "defaultValue": "this.minWidth"
            },
            "ariaLabelCloseButton": {
                "type": "string",
                "attribute": "aria-label-close-button",
                "mutable": false,
                "complexType": {
                    "original": "string",
                    "resolved": "string | undefined",
                    "references": {}
                },
                "required": false,
                "optional": true,
                "docs": {
                    "tags": [{
                            "name": "since",
                            "text": "3.2.0"
                        }],
                    "text": "ARIA label for the close icon button\nWill be set as aria-label on the nested HTML button element"
                },
                "getter": false,
                "setter": false,
                "reflect": false
            }
        };
    }
    static get states() {
        return {
            "showContent": {}
        };
    }
    static get events() {
        return [{
                "method": "open",
                "name": "open",
                "bubbles": true,
                "cancelable": true,
                "composed": true,
                "docs": {
                    "tags": [],
                    "text": "Fire event after drawer is open"
                },
                "complexType": {
                    "original": "any",
                    "resolved": "any",
                    "references": {}
                }
            }, {
                "method": "drawerClose",
                "name": "drawerClose",
                "bubbles": true,
                "cancelable": true,
                "composed": true,
                "docs": {
                    "tags": [],
                    "text": "Fire event after drawer is close"
                },
                "complexType": {
                    "original": "any",
                    "resolved": "any",
                    "references": {}
                }
            }];
    }
    static get methods() {
        return {
            "toggleDrawer": {
                "complexType": {
                    "signature": "(show?: boolean) => Promise<void>",
                    "parameters": [{
                            "name": "show",
                            "type": "boolean | undefined",
                            "docs": "Overwrite toggle state with boolean"
                        }],
                    "references": {
                        "Promise": {
                            "location": "global",
                            "id": "global::Promise"
                        }
                    },
                    "return": "Promise<void>"
                },
                "docs": {
                    "text": "Toggle or define show state of drawer",
                    "tags": [{
                            "name": "param",
                            "text": "show Overwrite toggle state with boolean"
                        }]
                }
            }
        };
    }
    static get watchers() {
        return [{
                "propName": "show",
                "methodName": "onShowChanged"
            }];
    }
}
//# sourceMappingURL=drawer.js.map
