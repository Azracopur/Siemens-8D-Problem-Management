{"version":3,"file":"tree.js","sources":["../../src/tree/tree.tsx"],"sourcesContent":["'use client';\n/*\n * SPDX-FileCopyrightText: 2024 Siemens AG\n *\n * SPDX-License-Identifier: MIT\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nimport {\n  Components,\n  type TreeContext,\n  UpdateCallback,\n  type IxTreeCustomEvent,\n} from '@siemens/ix';\nimport React, { useCallback, useRef } from 'react';\nimport ReactDOM, { Root } from 'react-dom/client';\nimport InternalIxTree from './internal-tree';\n\nexport type IxTreeProps = Omit<\n  Components.IxTree,\n  'renderItem' | 'markItemsAsDirty' | 'refreshTree'\n> & {\n  renderItem?: (data: any) => React.ReactNode;\n  onContextChange?: (event: IxTreeCustomEvent<TreeContext>) => void;\n  onNodeToggled?: (\n    event: CustomEvent<{ id: string; isExpaned: boolean }>\n  ) => void;\n  onNodeClicked?: (event: CustomEvent<string>) => void;\n  onNodeRemoved?: (event: CustomEvent<any>) => void;\n};\n\nexport const IxTree = React.forwardRef(\n  (props: IxTreeProps, ref: React.ForwardedRef<Components.IxTree>) => {\n    const cachedRootNodes = useRef<Map<HTMLElement, Root>>(new Map());\n\n    const renderItem = useCallback(\n      (\n        _: number,\n        data: any,\n        __: any[],\n        context: TreeContext,\n        update: (callback: UpdateCallback) => void\n      ) => {\n        const treeItem = document.createElement('ix-tree-item');\n        const rootNode = ReactDOM.createRoot(treeItem);\n        treeItem.hasChildren = data.hasChildren;\n        treeItem.context = context[data.id];\n\n        if (props.renderItem) {\n          rootNode.render(props.renderItem(data.data));\n        }\n\n        update((itemData, newContext) => {\n          treeItem.context = newContext[itemData.id];\n          treeItem.hasChildren = itemData.hasChildren;\n\n          if (props.renderItem) {\n            rootNode.render(props.renderItem(itemData.data));\n          }\n        });\n\n        cachedRootNodes.current.set(treeItem, rootNode);\n        return treeItem;\n      },\n      []\n    );\n\n    return (\n      <InternalIxTree\n        //@ts-expect-error ref exposed by the StencilComponent type\n        ref={ref}\n        {...props}\n        renderItem={props.renderItem ? renderItem : undefined}\n        onNodeRemoved={(removed: CustomEvent<any[]>) => {\n          const { detail } = removed;\n\n          detail.forEach((removedItemElement) => {\n            if (cachedRootNodes.current.has(removedItemElement)) {\n              cachedRootNodes.current.get(removedItemElement)?.unmount();\n              cachedRootNodes.current.delete(removedItemElement);\n            }\n          });\n        }}\n      ></InternalIxTree>\n    );\n  }\n);\n\nexport default IxTree;\n"],"names":[],"mappings":";;;;;;AAiCO;;AAIH;;;AAUI;;AAGA;AACE;;AAGF;;AAEE;AAEA;AACE;;AAEJ;;AAGA;;;;;;;AAYE;AAEA;;;AAGI;;AAEJ;;AAIR;;"}