{"version":3,"file":"page.js","sourceRoot":"","sources":["../../../../src/tests/utils/test/page.ts"],"names":[],"mappings":"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","sourcesContent":["/*\n * SPDX-FileCopyrightText: 2024 Siemens AG\n *\n * SPDX-License-Identifier: MIT\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\nimport {\n  ElementHandle,\n  Page,\n  PageScreenshotOptions,\n  test as testBase,\n  TestInfo as _TestInfo,\n  expect,\n} from '@playwright/test';\nimport type { addIcons as _addIcons } from '@siemens/ix-icons';\n\ninterface TestInfo extends _TestInfo {\n  componentTest?: boolean;\n}\n\nexport type Mount = (\n  selector: string,\n  config?: {\n    headTags?: string[];\n    icons?: Record<string, string>;\n  }\n) => Promise<ElementHandle<HTMLElement>>;\n\nasync function extendPageFixture(page: Page, testInfo: TestInfo) {\n  const originalGoto = page.goto.bind(page);\n  const originalScreenshot = page.screenshot.bind(page);\n  const dataIxTheme = testInfo.project.metadata?.['data-ix-theme'] ?? 'classic';\n  const dataIxColorSchema =\n    testInfo.project.metadata?.['data-ix-color-schema'] ?? 'dark';\n  testInfo.annotations.push({\n    type: `${dataIxTheme} ${dataIxColorSchema}`,\n  });\n  page.goto = async (url: string, options) => {\n    if (testInfo.componentTest === true) {\n      return originalGoto(url, options);\n    }\n\n    const response = await originalGoto(\n      `http://127.0.0.1:8080/src/tests/${url}?data-ix-theme=${dataIxTheme}&data-ix-color-schema=${dataIxColorSchema}`,\n      options\n    );\n\n    await page.waitForTimeout(1000);\n    return response;\n  };\n\n  page.screenshot = async (options?: PageScreenshotOptions) => {\n    await page.waitForTimeout(150);\n    return originalScreenshot(options);\n  };\n\n  return page;\n}\n\nasync function mountComponent(\n  page: Page,\n  selector: string,\n  config?: {\n    headTags?: string[];\n    icons?: Record<string, string>;\n  }\n): Promise<ElementHandle<HTMLElement>> {\n  return page.evaluateHandle(\n    async ({ componentSelector, config }) => {\n      if (config?.headTags) {\n        config.headTags.forEach((tag) => {\n          const head = document.querySelector('head');\n          if (!head) {\n            throw new Error('No head tag found in the document.');\n          }\n\n          head.innerHTML += tag;\n        });\n      }\n\n      if (config?.icons) {\n        const moduleImport = await import(\n          //@ts-expect-error - Only existing on runtime\n          '/www/node_modules/@siemens/ix-icons/dist/index.js'\n        );\n        const addIcons: typeof _addIcons = moduleImport.addIcons;\n        addIcons(config.icons);\n      }\n\n      const loadScript = document.createElement('script');\n      loadScript.src = '/scripts/e2e/load-e2e-runtime.js';\n      document.body.appendChild(loadScript);\n\n      await new Promise<void>((resolve) => {\n        loadScript.onload = async () => {\n          resolve();\n        };\n      });\n\n      await window.customElements.whenDefined('ix-button');\n      const mount = document.querySelector('#mount');\n\n      if (!mount) {\n        throw new Error('No mount point found in the document.');\n      }\n\n      mount.innerHTML = componentSelector;\n      return mount.children.item(0) as HTMLElement;\n    },\n    { componentSelector: selector, config }\n  );\n}\n\nexport const regressionTest = testBase.extend<{\n  mount: (\n    selector: string,\n    config?: {\n      headTags?: string[];\n      icons?: Record<string, string>;\n    }\n  ) => Promise<ElementHandle<HTMLElement>>;\n  createElement: (\n    selector: string,\n    appendTo?: ElementHandle<Element>\n  ) => Promise<ElementHandle<HTMLElement>>;\n}>({\n  page: async ({ page }, use, testInfo) => {\n    page = await extendPageFixture(page, testInfo);\n\n    await page.route('*/**/svg/*.svg', async (route, request) => {\n      if (!process.env.CI) {\n        const [, svg] = request.url().split('/svg/');\n        console.warn(\n          testInfo.file,\n          testInfo.title,\n          'SVGs fetched by static path',\n          svg\n        );\n\n        expect(false, 'SVGs fetched by static path').toBe(true);\n      }\n\n      return route.continue();\n    });\n\n    await use(page);\n  },\n  createElement: async ({ page }, use) => {\n    use((selector, appendTo) =>\n      page.evaluateHandle(\n        async ({ selector, appendTo }) => {\n          const elm = document.createElement(selector);\n\n          if (appendTo) {\n            appendTo.appendChild(elm);\n          }\n\n          return elm;\n        },\n        {\n          selector,\n          appendTo,\n        }\n      )\n    );\n  },\n  mount: async ({ page }, use, testInfo: TestInfo) => {\n    testInfo.componentTest = true;\n    const dataIxTheme =\n      testInfo.project.metadata?.['data-ix-theme'] ?? 'classic';\n    const dataIxColorSchema =\n      testInfo.project.metadata?.['data-ix-color-schema'] ?? 'dark';\n    testInfo.annotations.push({\n      type: `${dataIxTheme} ${dataIxColorSchema}`,\n    });\n    await page.goto(\n      `http://127.0.0.1:8080/src/tests/utils/ct/index.html?data-ix-theme=${dataIxTheme}&data-ix-color-schema=${dataIxColorSchema}`\n    );\n    await use((selector, config) => mountComponent(page, selector, config));\n  },\n});\n\nexport const test = regressionTest;\n"]}