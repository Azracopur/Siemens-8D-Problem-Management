{"version":3,"file":"portal.js","sources":["../../src/modal/portal.tsx"],"sourcesContent":["'use client';\n/*\n * SPDX-FileCopyrightText: 2024 Siemens AG\n *\n * SPDX-License-Identifier: MIT\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nimport { useEffect, useLayoutEffect, useRef, useState } from 'react';\nimport ReactDOM from 'react-dom';\nimport { ReactFrameworkDelegate } from '../delegate';\n\nexport const PORTAL_ID = 'ix-portal';\n\nexport const IxOverlay = (props: { delegate: ReactFrameworkDelegate }) => {\n  const [portalRef, setPortalRef] = useState<Element | null>(null);\n\n  const resolveElementRef = useRef<\n    Record<string, (value: Element | PromiseLike<Element>) => void>\n  >({});\n\n  const viewRefs = useRef<Record<string, any>>({});\n  const [views, setViews] = useState<Record<string, any>>({});\n\n  useEffect(() => {\n    const addOverlay = (id: string, view: any) => {\n      const _views = { ...viewRefs.current };\n      _views[id] = view;\n      setViews(_views);\n      viewRefs.current = _views;\n    };\n\n    const removeOverlay = (id: string) => {\n      const _views = { ...viewRefs.current };\n      delete _views[id];\n      setViews(_views);\n      viewRefs.current = _views;\n    };\n\n    props.delegate.attachViewToPortal = async (id, view) => {\n      addOverlay(id, view);\n      return new Promise<Element>((resolve) => {\n        const r = { ...resolveElementRef.current };\n        r[id] = resolve;\n        resolveElementRef.current = r;\n      });\n    };\n\n    props.delegate.removeViewFromPortal = async (id: string) => {\n      removeOverlay(id);\n    };\n\n    props.delegate.portalReady();\n  }, []);\n\n  useLayoutEffect(() => {\n    const portalRef = document.querySelector(`#${PORTAL_ID}`);\n    if (portalRef) {\n      setPortalRef(portalRef);\n    }\n  }, []);\n\n  useLayoutEffect(() => {\n    Object.keys(views).forEach((key) => {\n      const resolveQueue = { ...resolveElementRef.current };\n      const element = document.querySelector(`[data-portal-id=\"${key}\"]`);\n      if (element && element.children.length === 1 && resolveQueue[key]) {\n        const view = element.children[0];\n        resolveQueue[key](view);\n      }\n    });\n  }, [views]);\n\n  if (!portalRef) {\n    return null;\n  }\n\n  return (\n    <>\n      {Object.keys(views).map((key) => {\n        const RenderView = views[key];\n        return ReactDOM.createPortal(\n          <div data-portal-id={key} style={{ display: 'contents ' }}>\n            {RenderView}\n          </div>,\n          portalRef,\n          key\n        );\n      })}\n    </>\n  );\n};\n"],"names":[],"mappings":";;;;;AAcO;AAEA;;AAGL;AAIA;;;AAIE;;AAEE;;AAEA;AACF;AAEA;;AAEE;;AAEA;AACF;;AAGE;AACA;;AAEE;AACA;AACF;AACF;;;AAIA;AAEA;;;;;;;;;;;;AAcE;;AAEE;;AAEJ;AACF;;AAGE;;AAGF;AAGM;;;AAWR;;"}