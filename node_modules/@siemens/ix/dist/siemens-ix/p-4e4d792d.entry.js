import{r as t,c as i,h as s,H as e,g as o}from"./p-CtoreFVF.js";import{d as n}from"./p-D3K9vmFp.js";import{r as h,d as r}from"./p-DSTYytot.js";const c=t=>!Number.isNaN(Number(t));const l=(t,i)=>{t.classList.add(i)};class d{static create(t,i=d.defaultConfig){return new d(t,i)}static mergeStyle(t,i){for(let s in i){if(t.style[s]!==i[s]){t.style[s]=i[s]}}}static getMaxBrowserHeight(){const t=document.createElement("div");const i=document.createElement("div");d.mergeStyle(t,{position:"absolute",height:"1px",opacity:0});d.mergeStyle(i,{height:"1e7px"});t.appendChild(i);document.body.appendChild(t);const s=i.offsetHeight;document.body.removeChild(t);return s}constructor(t,i){this._lastRepaint=null;this._maxElementHeight=d.getMaxBrowserHeight();this.refresh(t,i);const s=this._config;const e=()=>{const t=this._getScrollPosition();const i=this._lastRepaint;this._renderAnimationFrame=window.requestAnimationFrame(e);if(t===i){return}const o=i?t-i:0;if(!i||o<0||o>this._averageHeight){let i=this._renderChunk();this._lastRepaint=t;if(i!==false&&typeof s.afterRender==="function"){s.afterRender()}}};e()}destroy(){window.cancelAnimationFrame(this._renderAnimationFrame)}refresh(t,i=d.defaultConfig){this._config=i;if(!t||t.nodeType!==1){throw new Error("HyperList requires a valid DOM Node container")}this._element=t;const s=this._config;const e=this._scroller||s.scroller||document.createElement(s.scrollerTagName||"tr");if(typeof s.useFragment!=="boolean"){this._config.useFragment=true}if(!s.generate){throw new Error("Missing required `generate` function")}if(!c(s.total)){throw new Error("Invalid required `total` value, expected number")}if(!Array.isArray(s.itemHeight)&&!c(s.itemHeight)){throw new Error(`\n        Invalid required \`itemHeight\` value, expected number or array\n      `.trim())}else if(c(s.itemHeight)){this._itemHeights=Array(s.total).fill(s.itemHeight)}else{this._itemHeights=[s.itemHeight]}Object.keys(d.defaultConfig).filter((t=>t in s)).forEach((t=>{const i=s[t];const e=c(i);if(i&&typeof i!=="string"&&typeof i!=="number"){let i=`Invalid optional \`${t}\`, expected string or number`;throw new Error(i)}else if(e){s[t]=`${i}px`}}));const o=Boolean(s.horizontal);const n=s[o?"width":"height"];if(n){const t=c(n);const i=t?false:n.slice(-1)==="%";const s=t?parseInt(n,10):parseInt(n.replace(/px|%/,""),10);const e=window[o?"innerWidth":"innerHeight"];if(i){this._containerSize=e*s/100}else{this._containerSize=c(n)?n:s}}const h=s.scrollContainer;const r=s.itemHeight*s.total;const l=this._maxElementHeight;if(r>l){console.warn(["HyperList: The maximum element height",l+"px has","been exceeded; please reduce your item height."].join(" "))}const a={width:`${s.width}`,height:h?`${r}px`:`${s.height}`,overflow:h?"none":"auto",position:"relative"};d.mergeStyle(t,a);if(h){d.mergeStyle(s.scrollContainer,{overflow:"auto"})}const f={opacity:"0",position:"absolute",[o?"height":"width"]:"1px",[o?"width":"height"]:`${r}px`};d.mergeStyle(e,f);if(!this._scroller){t.appendChild(e)}const u=this._computeScrollPadding();this._scrollPaddingBottom=u.bottom;this._scrollPaddingTop=u.top;this._scroller=e;this._scrollHeight=this._computeScrollHeight();this._itemPositions=this._itemPositions||Array(s.total).fill(0);this._computePositions(0);this._renderChunk(this._lastRepaint!==null);if(typeof s.afterRender==="function"){s.afterRender()}}_getRow(t){const i=this._config;let s=i.generate(t);let e=s.height;if(e!==undefined&&c(e)){s=s.element;if(e!==this._itemHeights[t]){this._itemHeights[t]=e;this._computePositions(t);this._scrollHeight=this._computeScrollHeight()}}else{e=this._itemHeights[t]}if(!s||s.nodeType!==1){throw new Error(`Generator did not return a DOM Node for index: ${t}`)}l(s,i.rowClassName||"vrow");const o=this._itemPositions[t]+this._scrollPaddingTop;d.mergeStyle(s,{position:"absolute",[i.horizontal?"left":"top"]:`${o}px`});return s}_getScrollPosition(){const t=this._config;if(typeof t.overrideScrollPosition==="function"){return t.overrideScrollPosition()}return this._element[t.horizontal?"scrollLeft":"scrollTop"]}_renderChunk(t=false){const i=this._config;const s=this._element;const e=this._getScrollPosition();const o=i.total;let n=this._getFrom(e)-1;if(n<0||n-this._screenItemsLen<0){n=0}if(!t&&this._lastFrom===n){return false}this._lastFrom=n;let h=n+this._cachedItemsLen;if(h>o||h+this._cachedItemsLen>o){h=o}const r=i.useFragment?document.createDocumentFragment():[];const c=this._scroller;r[i.useFragment?"appendChild":"push"](c);for(let t=n;t<h;t++){let s=this._getRow(t);r[i.useFragment?"appendChild":"push"](s)}if(i.applyPatch){return i.applyPatch(s,r)}s.innerHTML="";s.appendChild(r)}_computePositions(t=1){const i=this._config;const s=i.total;if(t<1){t=1}for(let i=t;i<s;i++){this._itemPositions[i]=this._itemHeights[i-1]+this._itemPositions[i-1]}}_computeScrollHeight(){const t=this._config;const i=Boolean(t.horizontal);const s=t.total;const e=this._itemHeights.reduce(((t,i)=>t+i),0)+this._scrollPaddingBottom+this._scrollPaddingTop;d.mergeStyle(this._scroller,{opacity:0,position:"absolute",top:"0px",[i?"height":"width"]:"1px",[i?"width":"height"]:`${e}px`});const o=this._itemHeights.slice(0).sort(((t,i)=>t-i));const n=Math.floor(s/2);const h=s%2===0?(o[n]+o[n-1])/2:o[n];const r=i?"clientWidth":"clientHeight";const c=t.scrollContainer?t.scrollContainer:this._element;const l=c[r]?c[r]:this._containerSize;this._screenItemsLen=Math.ceil(l/h);this._containerSize=l;this._cachedItemsLen=Math.max(this._cachedItemsLen||0,this._screenItemsLen*3);this._averageHeight=h;return e}_computeScrollPadding(){const t=this._config;const i=Boolean(t.horizontal);const s=window.getComputedStyle(this._element);const e=t=>{const i=s.getPropertyValue(`padding-${t}`);return parseInt(i,10)||0};if(i){return{bottom:e("right"),top:e("left")}}else{return{bottom:e("bottom"),top:e("top")}}}_getFrom(t){let i=0;while(this._itemPositions[i]<t){i++}return i}}d.defaultConfig={width:"100%",height:"100%"};const a=":host{display:block}";const f=class{constructor(s){t(this,s);this.contextChange=i(this,"contextChange",7);this.nodeToggled=i(this,"nodeToggled",7);this.nodeClicked=i(this,"nodeClicked",7);this.nodeRemoved=i(this,"nodeRemoved",7);this.root="root";this.model={};this.context={};this.updates=new Map;this.hasFirstRender=false;this.dirtyItems=new Set}updatePadding(t,i){t.style.paddingLeft=i.level+"rem"}getVirtualizerOptions(t){const i=this.buildTreeList(this.model[this.root]);return{width:"100%",height:"100%",itemHeight:32,total:i.length,generate:s=>{const e=i[s];const o=this.hostElement.querySelector(`[data-tree-node-id="${e.id}"]`);const n=this.getContext(e.id);if(o&&t.force===false){o.hasChildren=e.hasChildren;o.context=Object.assign({},n);let t=this.dirtyItems.has(e.id);if(this.updates.has(e.id)){const i=this.updates.get(e.id);if(i){const s=i(e,Object.assign({},this.context));if(typeof s==="boolean"){t=s}}}this.updatePadding(o,e);if(!t){return o}}const r=t=>{this.updates.set(e.id,t)};let c=null;if(this.renderItem){c=this.renderItem(s,e,i,Object.assign({},this.context),r)}if(c===null){c=h(e,n,r)}const l=c;l.setAttribute("data-tree-node-id",e.id);l.style.paddingRight="1rem";this.updatePadding(l,e);this.dirtyItems.delete(e.id);return l}}}setContext(t,i){this.context=Object.assign(Object.assign({},this.context),{[t]:i});this.contextChange.emit(this.context)}getContext(t){if(!this.context){return{isExpanded:false,isSelected:false}}if(!this.context[t]){this.context[t]={isExpanded:false,isSelected:false}}return this.context[t]}buildTreeList(t,i=0){const s=[];if(t===null||t===void 0?void 0:t.hasChildren){const e=i+1;t.children.forEach((t=>{const o=this.model[t];const n=this.getContext(t);s.push(Object.assign(Object.assign({},o),{level:i}));if(o.hasChildren&&n.isExpanded){s.push(...this.buildTreeList(o,e))}}))}return s}componentDidLoad(){this.initList();this.observer=new MutationObserver((t=>{let i=[];t.forEach((t=>{i=[...i,...Array.from(t.removedNodes)];t.addedNodes.forEach((t=>{const s=i.indexOf(t);if(s>=0){i.splice(s,1)}}))}));this.nodeRemoved.emit(i)}));this.observer.observe(this.hostElement,{childList:true})}componentWillRender(){this.hasFirstRender=true;if(this.isListInitialized()){this.refreshTree()}else{this.initList()}}connectedCallback(){if(this.hasFirstRender){this.initList()}}disconnectedCallback(){var t,i;(t=this.hyperlist)===null||t===void 0?void 0:t.destroy();(i=this.observer)===null||i===void 0?void 0:i.disconnect()}onModelChange(){if(this.hasFirstRender&&!this.isListInitialized()){this.initList()}}async markItemsAsDirty(t){t.forEach((t=>this.dirtyItems.add(t)))}isListInitialized(){var t;const i=(t=this.hyperlist)===null||t===void 0?void 0:t._itemPositions;return i!==undefined&&i.length&&!(i===null||i===void 0?void 0:i.some((t=>t===undefined||Number.isNaN(t))))}async refreshTree(t=r){if(this.hyperlist){this.hyperlist.refresh(this.hostElement,this.getVirtualizerOptions(t))}}initList(){var t;if(!this.model){return}(t=this.hyperlist)===null||t===void 0?void 0:t.destroy();const i=this.getVirtualizerOptions(r);this.hyperlist=new d(this.hostElement,i)}onToggle(t){const{target:i}=t;t.preventDefault();t.stopPropagation();if(!(i instanceof HTMLElement)){return}const s=i.getAttribute("data-tree-node-id");if(!s){return}const e=this.model[s];if(!e.hasChildren){return}const o=this.getContext(s);o.isExpanded=!o.isExpanded;this.nodeToggled.emit({id:s,isExpanded:o.isExpanded});this.setContext(s,o)}onTreeItemClick(t){const{target:i}=t;if(!(i instanceof HTMLElement)){return}const s=i.getAttribute("data-tree-node-id");if(!s){return}const e=this.model[s];const o=t.composedPath();const h=o.indexOf(this.hostElement);const r=o.slice(0,h);const c=n.pathIncludesTrigger(r);if(c){return}if(!t.defaultPrevented){Object.values(this.context).forEach((t=>t.isSelected=false));const t=this.getContext(s);t.isSelected=true;this.setContext(s,t)}if(this.toggleOnItemClick&&e.hasChildren){const t=this.getContext(s);t.isExpanded=!t.isExpanded;this.nodeToggled.emit({id:s,isExpanded:t.isExpanded});this.setContext(s,t)}this.nodeClicked.emit(s)}render(){return s(e,{key:"ca0d582877d3b2877a1090cc0aeb40f38617cef9",onClick:t=>this.onTreeItemClick(t)},s("slot",{key:"2d8f21165234243b6d2e2f7c99696fc7343d79f2"}))}get hostElement(){return o(this)}static get watchers(){return{model:["onModelChange"]}}};f.style=a;export{f as ix_tree};
//# sourceMappingURL=p-4e4d792d.entry.js.map