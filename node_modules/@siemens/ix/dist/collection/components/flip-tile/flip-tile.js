/*
 * SPDX-FileCopyrightText: 2023 Siemens AG
 *
 * SPDX-License-Identifier: MIT
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
import { iconEye } from "@siemens/ix-icons/icons";
import { h, Host, } from "@stencil/core";
import { animate } from "animejs";
import Animation from "../utils/animation";
import { createMutationObserver } from "../utils/mutation-observer";
import { hasSlottedElements } from "../utils/shadow-dom";
export class FlipTile {
    constructor() {
        /**
         * Variation of the Flip
         *
         * @since 4.0.0
         */
        this.variant = 'filled';
        /**
         * Height interpreted as REM
         */
        this.height = 15.125;
        /**
         * Width interpreted as REM
         */
        this.width = 16;
        /**
         * Index of the currently visible content
         * @since 3.0.0
         */
        this.index = 0;
        this.isFlipAnimationActive = false;
        this.hasFooterSlot = false;
        this.contentItems = [];
    }
    watchIndex(newIndex, oldIndex) {
        if (newIndex === oldIndex) {
            return;
        }
        this.doFlipAnimation(newIndex);
    }
    componentDidLoad() {
        this.observer = createMutationObserver(() => this.updateContentItems());
        this.observer.observe(this.hostElement, {
            childList: true,
        });
    }
    componentWillLoad() {
        this.updateContentItems();
        this.updateContentVisibility(this.index);
    }
    disconnectedCallback() {
        if (this.observer) {
            this.observer.disconnect();
        }
    }
    handleFooterSlotChange(event) {
        const { target } = event;
        const slot = target;
        this.hasFooterSlot = hasSlottedElements(slot);
    }
    updateContentItems() {
        this.contentItems = Array.from(this.hostElement.querySelectorAll('ix-flip-tile-content'));
    }
    updateContentVisibility(indexVisible) {
        this.contentItems.forEach((content, index) => (content.contentVisible = index === indexVisible));
    }
    toggleIndex() {
        let newIndex;
        const oldIndex = this.index;
        if (this.index >= this.contentItems.length - 1) {
            newIndex = 0;
        }
        else {
            newIndex = this.index + 1;
        }
        const { defaultPrevented } = this.toggle.emit(newIndex);
        if (defaultPrevented) {
            this.index = oldIndex;
            return;
        }
        this.doFlipAnimation(newIndex);
    }
    doFlipAnimation(index) {
        if (this.isFlipAnimationActive) {
            return;
        }
        this.isFlipAnimationActive = true;
        animate(this.hostElement.shadowRoot.querySelector('.flip-tile-container'), {
            keyframes: {
                '0%': {
                    transform: 'rotateY(0)',
                },
                '50%': {
                    transform: 'rotateY(90deg)',
                },
                '51%': {
                    transform: 'rotateY(270deg)',
                },
                '100%': {
                    transform: 'rotateY(360deg)',
                },
            },
            duration: Animation.defaultTime,
            easing: 'ease-in-out',
            onComplete: () => {
                this.index = index;
                this.updateContentVisibility(this.index);
            },
        });
        setTimeout(() => {
            this.isFlipAnimationActive = false;
        }, 2 * Animation.defaultTime);
    }
    render() {
        return (h(Host, { key: '32727b4df750f9d1892f365a7e8d729447be05ac', class: {
                [`flip-tile-variant-${this.variant}`]: true,
            }, style: {
                height: `${this.height}${this.height === 'auto' ? '' : 'rem'}`,
                'min-height': `${this.height}${this.height === 'auto' ? '' : 'rem'}`,
                'max-height': `${this.height}${this.height === 'auto' ? '' : 'rem'}`,
                width: `${this.width}${this.width === 'auto' ? '' : 'rem'}`,
                'min-width': `${this.width}${this.width === 'auto' ? '' : 'rem'}`,
                'max-width': `${this.width}${this.width === 'auto' ? '' : 'rem'}`,
            } }, h("div", { key: 'e58093dce55ede49f9f1782327c73918ee21d2c6', class: "flip-tile-container" }, h("div", { key: 'bd60e44b5b04177c4003936aa15d6539cd093883', class: "flip-tile-header" }, h("div", { key: '792d0e39b406fb50561f3c35c0340ee827b568e6', class: "header-slot-container text-l-title" }, h("slot", { key: '9e320aef9f89689b594c9555e154c8795dbdb233', name: "header" })), h("ix-icon-button", { key: 'dc0a042565001a79ea17e33671f4c2486b702ebf', icon: iconEye, variant: "tertiary", onClick: () => this.toggleIndex(), "aria-label": this.ariaLabelEyeIconButton })), h("div", { key: 'fa61544ccf0e16884c4d747e0e7cc174216d7906', class: "content-container" }, h("slot", { key: '1ed79120c3e926bb5f48a0e1980f5dfb785050f8' })), h("div", { key: '543216df0a9e93c9a739b921259e529eb494e751', class: {
                footer: true,
                'show-footer': this.hasFooterSlot,
            } }, h("slot", { key: '271f61fc236be2813cec900c788fe4bfcb2c285d', name: "footer", onSlotchange: (event) => this.handleFooterSlotChange(event) })))));
    }
    static get is() { return "ix-flip-tile"; }
    static get encapsulation() { return "shadow"; }
    static get originalStyleUrls() {
        return {
            "$": ["flip-tile.scss"]
        };
    }
    static get styleUrls() {
        return {
            "$": ["flip-tile.css"]
        };
    }
    static get properties() {
        return {
            "variant": {
                "type": "string",
                "attribute": "variant",
                "mutable": false,
                "complexType": {
                    "original": "FlipTileVariant",
                    "resolved": "\"alarm\" | \"filled\" | \"info\" | \"outline\" | \"primary\" | \"warning\"",
                    "references": {
                        "FlipTileVariant": {
                            "location": "import",
                            "path": "./flip-tile.types",
                            "id": "src/components/flip-tile/flip-tile.types.ts::FlipTileVariant"
                        }
                    }
                },
                "required": false,
                "optional": false,
                "docs": {
                    "tags": [{
                            "name": "since",
                            "text": "4.0.0"
                        }],
                    "text": "Variation of the Flip"
                },
                "getter": false,
                "setter": false,
                "reflect": false,
                "defaultValue": "'filled'"
            },
            "height": {
                "type": "any",
                "attribute": "height",
                "mutable": false,
                "complexType": {
                    "original": "number | 'auto'",
                    "resolved": "\"auto\" | number",
                    "references": {}
                },
                "required": false,
                "optional": false,
                "docs": {
                    "tags": [],
                    "text": "Height interpreted as REM"
                },
                "getter": false,
                "setter": false,
                "reflect": false,
                "defaultValue": "15.125"
            },
            "width": {
                "type": "any",
                "attribute": "width",
                "mutable": false,
                "complexType": {
                    "original": "number | 'auto'",
                    "resolved": "\"auto\" | number",
                    "references": {}
                },
                "required": false,
                "optional": false,
                "docs": {
                    "tags": [],
                    "text": "Width interpreted as REM"
                },
                "getter": false,
                "setter": false,
                "reflect": false,
                "defaultValue": "16"
            },
            "index": {
                "type": "number",
                "attribute": "index",
                "mutable": false,
                "complexType": {
                    "original": "number",
                    "resolved": "number",
                    "references": {}
                },
                "required": false,
                "optional": false,
                "docs": {
                    "tags": [{
                            "name": "since",
                            "text": "3.0.0"
                        }],
                    "text": "Index of the currently visible content"
                },
                "getter": false,
                "setter": false,
                "reflect": false,
                "defaultValue": "0"
            },
            "ariaLabelEyeIconButton": {
                "type": "string",
                "attribute": "aria-label-eye-icon-button",
                "mutable": false,
                "complexType": {
                    "original": "string",
                    "resolved": "string | undefined",
                    "references": {}
                },
                "required": false,
                "optional": true,
                "docs": {
                    "tags": [{
                            "name": "since",
                            "text": "3.2.0"
                        }],
                    "text": "ARIA label for the eye icon button\nWill be set as aria-label on the nested HTML button element"
                },
                "getter": false,
                "setter": false,
                "reflect": false
            }
        };
    }
    static get states() {
        return {
            "isFlipAnimationActive": {},
            "hasFooterSlot": {}
        };
    }
    static get events() {
        return [{
                "method": "toggle",
                "name": "toggle",
                "bubbles": true,
                "cancelable": true,
                "composed": true,
                "docs": {
                    "tags": [{
                            "name": "since",
                            "text": "3.0.0"
                        }],
                    "text": "Event emitted when the index changes"
                },
                "complexType": {
                    "original": "number",
                    "resolved": "number",
                    "references": {}
                }
            }];
    }
    static get elementRef() { return "hostElement"; }
    static get watchers() {
        return [{
                "propName": "index",
                "methodName": "watchIndex"
            }];
    }
}
//# sourceMappingURL=flip-tile.js.map
